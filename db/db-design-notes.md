# Database Design Notes

-------------------------------------------------------------------------------
## 2021-08-10 (Lakshika)

### DB Design
-No changes required to the DB design.
### Front end consideration
-Would need to fetch the vehicles table from the DB and present it to the user when they are registering for the service as user_vehicles takes into account only the ID referring to the vehicles table.
### Vehicle Emissions Table
-Have changed the values of the emissions/km in the vehicles table. 
-Would also need to create a small function that takes a shared cab system into consideration i.e. if the user opts for shared cab/ car pool, need to divide the emission generated by 'provate taxi' by the number of people.

-------------------------------------------------------------------------------
## 2021-08-04 (Robyn)

### Normalisation
Have tried to normalise DB to 3NF.

#### 1NF
* columns in a table are unique (i.e. no two columns in one table share the 
same name or contain the same data)  

* each table cell contains a single value, e.g.  
  * user name is split into fname and lname so both fields are not in a single 
cell)  

* each record in a table is unique, e.g.  
  * primary keys used to make sure duplicate records are not allowed  

#### 2NF
* no partial functional dependencies (i.e. if the primary key is a composite 
key, then every non-key column depends on ALL of the primary key columns, not 
on only some of them), e.g.  

  * the journeys table has a composite primary key but every detail of a 
journey (value in each column of a specific record) depends on both primary key 
columns (i.e. you need to know both the user_id and the journey_id to be able 
to say what the distance of a particular journey was - multiple users will 
have a journey_id of 15 for example, so you need to know the user_id to know 
which journey 15 the distance refers to  

  * in the emissions table, you need to know both the user_id and the 
journey_id to locate the specific carbon emitted for a journey  


#### 3NF
* no transitive functional dependencies (i.e. no column depends on a non-key 
column), e.g.  

  * I moved the carbon_emitted column out of the journeys 
table as these depend on the distance and vehicle_id columns  


### User Vehicles Table
I initially designed this table as it appears separately and on its own in the 
top right of the diagram. This made sense initially, however I'm not sure if it 
integrates nicely with the rest of the DB. I have put my preferred table in the 
actual DB design but we might want to go back to the old version later 
depending on how we want to write the Python code. I've also left the old 
version in as the transportation types listed as columns could be the options 
we let the users select when they register their own transportation types.  

I think we should just have a selection of general vehicle types with default 
carbon emissions per km that we program in. A future version would allow the 
user to register a vehicle and get more precise carbon emissions for that 
vehicle, for example they could select their specific make, model and age of 
car and store it to their account. If they had more than one car in their 
household, the journey results could display the total emissions for both 
vehicles and they can then decide which one to drive for that particular 
journey. This is not something we will do for the Nanodegree as it would 
require finding another API, one that has data on the carbon emissions of most 
cars or building this API from scratch.


### User mobility ability
I was trying to think about how we could let a user provide details on things 
like their age and mobility. To avoid all this private data being collected and 
stored, we could just ask the user to register foot (or a different, more 
appropriate word that would capture wheelchair users too) as a "user vehicle". 
This would use our built-in metric (e.g. walking distances only provided if 
journey is less than 5 km). This would be the most basic version of the system 
and in the next sprint we could add a feature that lets the user register the 
maximum walking distance they would be capable of, which would override our 
built-in maximum walking distance metric (the same could be done for cycling).


## Journeys table
For the journey date and time, TIMESTAMP could have been used to calculate the 
date and time that the entry was stored in the DB. I think it is better to use 
DATETIME and get the current date and time in Python when we ask the user to 
log their journey.  

j_name is a field that will be generated within Python and will include the 
origin and destination, e.g. "\<origin> to \<destination>". It would be visible 
in the user's journey history like this. I couldn't put an origin and 
destination column in this table as distance depends on the origin and 
destination so it would stop the journey table being in 3NF. We might need to 
review this table structure when we are more familiar with the google maps API 
or if we want to store the origin and destination locations.


### Miles or kilometers
We need to decide if we are using miles or kilometers. The final product would 
let the user specify their preferred distance measurement but I think we should 
build the prototype with just one. Although we mainly use miles in the UK, I 
think we should build the app using km as it is easier to calculate. We can 
add in the miles option later if we have time.  


### Emissions table
This table stores the carbon emitted for each journey. I have only included 
carbon emitted and no details on carbon saved. We will probably want to decide 
later if we want to store things like total carbon saved per user and total 
journeys made per user in the DB or if we just calculate those with Python. We 
also need to decide what carbon saved actually is. It is carbon saved but in 
comparison to what? Each users stored transport method? Or does the user 
specify and intended transport method then they select a better one? I think 
the first option is probably best. But will need to be incorporated into the 
app somehow.


### Further DB development
We will probably need to add more tables to the DB as we go. I was thinking 
that the feature to be able to compare the total carbon offset to other things 
such as number of trees planted could be a "nice to have" feature, rather than 
a "must have" feature as the main thing is to let the user see a value 
representing how much carbon they've offset but it would be a bonus to see that 
value in various equivalent examples. We could later add a table that holds 
constants to convert raw carbon emissions into various things in our next 
sprint if we have time.
